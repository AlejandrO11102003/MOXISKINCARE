<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD de Usuarios</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 900px;
        margin: auto;
      }
      form {
        margin-bottom: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      form div {
        margin-bottom: 10px;
      }
      label {
        display: inline-block;
        width: 100px;
      }
      input[type='text'],
      input[type='email'],
      input[type='password'] {
        width: 200px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      button {
        padding: 10px 15px;
        background-color: #a8608a;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      .edit-btn,
      .delete-btn {
        margin-right: 5px;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
      }
      .edit-btn {
        background-color: #28a745;
        color: white;
        border: none;
      }
      .delete-btn {
        background-color: #dc3545;
        color: white;
        border: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Gestión de Usuarios</h1>
      <form id="userForm">
        <input type="hidden" id="userId" />
        <div>
          <label for="nombre">Nombre:</label>
          <input type="text" id="nombre" required />
        </div>
        <div>
          <label for="apellidos">Apellidos:</label>
          <input type="text" id="apellidos" required />
        </div>
        <div>
          <label for="correo">Correo:</label>
          <input type="email" id="correo" required />
        </div>
        <div>
          <label for="password">Contraseña:</label>
          <input type="password" id="password" required />
        </div>
        <div>
          <label for="telefono">Teléfono:</label>
          <input type="text" id="telefono" />
        </div>
        <div>
          <label for="direccion">Dirección:</label>
          <input type="text" id="direccion" />
        </div>
        <button type="submit" id="submitBtn">Crear Usuario</button>
        <button type="button" id="cancelBtn" style="display: none">
          Cancelar Edición
        </button>
      </form>

      <h2>Lista de Usuarios</h2>
      <table id="usersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Apellidos</th>
            <th>Correo</th>
            <th>Teléfono</th>
            <th>Dirección</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <!-- inyeccion body -->
        </tbody>
      </table>
    </div>

    <script>
      const API_URL = '/usuario';

      document.addEventListener('DOMContentLoaded', () => {
        fetchUsers();
        const userForm = document.getElementById('userForm');
        userForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const userId = document.getElementById('userId').value;
          const userData = {
            nombre: document.getElementById('nombre').value,
            apellidos: document.getElementById('apellidos').value,
            correo: document.getElementById('correo').value,
            password: document.getElementById('password').value,
            telefono: document.getElementById('telefono').value,
            direccion: document.getElementById('direccion').value,
          };

          if (userId) {
            await updateUser(userId, userData);
          } else {
            await createUser(userData);
          }
          resetForm();
          fetchUsers();
        });

        document.getElementById('cancelBtn').addEventListener('click', () => {
          resetForm();
        });
      });

      async function fetchUsers() {
        try {
          const response = await fetch(API_URL);
          const users = await response.json();
          const usersTableBody = document.querySelector('#usersTable tbody');
          usersTableBody.innerHTML = '';
          users.forEach((user) => {
            const row = usersTableBody.insertRow();
            row.innerHTML = `
                        <td>${user.idUsuario}</td>
                        <td>${user.nombre}</td>
                        <td>${user.apellidos}</td>
                        <td>${user.correo}</td>
                        <td>${user.telefono || ''}</td>
                        <td>${user.direccion || ''}</td>
                        <td>
                            <button class="edit-btn" onclick="editUser(${
                              user.idUsuario
                            })">Editar</button>
                            <button class="delete-btn" onclick="deleteUser(${
                              user.idUsuario
                            })">Eliminar</button>
                        </td>
                    `;
          });
        } catch (error) {
          console.error('Error fetching users:', error);
        }
      }

      async function createUser(user) {
        try {
          await fetch(API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(user),
          });
        } catch (error) {
          console.error('Error creating user:', error);
        }
      }

      async function updateUser(id, user) {
        try {
          await fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(user),
          });
        } catch (error) {
          console.error('Error updating user:', error);
        }
      }

      async function editUser(id) {
        try {
          const response = await fetch(`${API_URL}/${id}`);
          const user = await response.json();
          document.getElementById('userId').value = user.idUsuario;
          document.getElementById('nombre').value = user.nombre;
          document.getElementById('apellidos').value = user.apellidos;
          document.getElementById('correo').value = user.correo;
          document.getElementById('password').value = user.password; // Considerar no precargar contraseñas reales
          document.getElementById('telefono').value = user.telefono;
          document.getElementById('direccion').value = user.direccion;

          document.getElementById('submitBtn').textContent =
            'Actualizar Usuario';
          document.getElementById('cancelBtn').style.display = 'inline-block';
        } catch (error) {
          console.error('Error fetching user for edit:', error);
        }
      }

      async function deleteUser(id) {
        if (confirm('¿Estás seguro de que quieres eliminar este usuario?')) {
          try {
            await fetch(`${API_URL}/${id}`, {
              method: 'DELETE',
            });
            fetchUsers(); // Volver a cargar la lista después de eliminar
          } catch (error) {
            console.error('Error deleting user:', error);
          }
        }
      }

      function resetForm() {
        document.getElementById('userForm').reset();
        document.getElementById('userId').value = '';
        document.getElementById('submitBtn').textContent = 'Crear Usuario';
        document.getElementById('cancelBtn').style.display = 'none';
      }
    </script>
  </body>
</html>
