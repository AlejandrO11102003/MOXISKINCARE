<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administración MoxiSkincare</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/index.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --brand-pink: #e6a4b4;
        --brand-pink-light: #f5e6e8;
        --brand-dark: #212529;
        --brand-white: #ffffff;
        --bs-primary: var(--brand-pink);
        --bs-primary-rgb: 230, 164, 180;
        --bs-body-bg: var(--brand-pink-light);
        --bs-link-color: var(--brand-pink);
        --bs-link-hover-color: #b88390;
      }

      body {
        display: flex;
        min-height: 100vh;
        font-family: 'Poppins', sans-serif;
        margin: 0;
        background-color: var(--bs-body-bg);
      }
      .sidebar {
        width: 250px;
        background-color: var(--brand-dark);
        color: var(--brand-pink-light);
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
      }
      .sidebar h2 {
        text-align: center;
        margin-bottom: 30px;
        color: var(--brand-white);
        font-weight: 700;
      }
      .sidebar ul {
        list-style: none;
        padding: 0;
      }
      .sidebar ul li {
        margin-bottom: 10px;
      }
      .sidebar ul li a {
        color: var(--brand-pink-light);
        text-decoration: none;
        padding: 10px 15px;
        display: block;
        border-radius: 5px;
        transition: background-color 0.3s ease;
      }
      .sidebar ul li a:hover,
      .sidebar ul li a.active {
        background-color: var(--brand-pink);
        color: var(--brand-dark);
        font-weight: 600;
      }
      .content {
        flex-grow: 1;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 8px;
        margin: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      }
      .btn-primary {
        --bs-btn-color: var(--brand-dark);
        --bs-btn-hover-bg: #d990a2;
        --bs-btn-border-color: #d990a2;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>Modulos</h2>
      <ul>
        <li><a href="/categorias">Categorías</a></li>
        <li><a href="/productos">Productos</a></li>
        <li><a href="/usuarios">Usuarios</a></li>
      </ul>
    </div>
    <main id="main-content" class="content"></main>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      const routes = {
        '/usuarios': '/fragments/usuarios',
        '/categorias': '/fragments/categorias',
        '/productos': '/fragments/productos',
      };
      const loadContent = async (path) => {
        const contentDiv = document.getElementById('main-content');
        const route = routes[path];
        document.querySelectorAll('.sidebar a').forEach((link) => {
          if (link.getAttribute('href') === path) {
            link.classList.add('active');
          } else {
            link.classList.remove('active');
          }
        });

        if (route) {
          try {
            const response = await fetch(route);
            if (!response.ok) {
              throw new Error(
                `Error al cargar el fragmento: ${response.statusText}`
              );
            }
            const html = await response.text();
            contentDiv.innerHTML = `<div class="container-fluid p-4">${html}</div>`;

            Array.from(contentDiv.querySelectorAll('script')).forEach(
              (oldScript) => {
                const newScript = document.createElement('script');
                Array.from(oldScript.attributes).forEach((attr) =>
                  newScript.setAttribute(attr.name, attr.value)
                );
                newScript.appendChild(
                  document.createTextNode(oldScript.innerHTML)
                );
                oldScript.parentNode.replaceChild(newScript, oldScript);
              }
            );
          } catch (error) {
            console.error('No se pudo cargar el contenido:', error);
            contentDiv.innerHTML =
              '<div class="container-fluid p-4"><h1>Error al cargar la página.</h1></div>';
          }
        } else {
          if (path === '/' || path.startsWith('/login')) {
            window.location.href = '/categorias';
            return;
          }
          contentDiv.innerHTML =
            '<div class="container-fluid p-4"><h1>Página no encontrada</h1><p>Selecciona una opción del menú.</p></div>';
        }
      };

      document.querySelector('.sidebar').addEventListener('click', (e) => {
        if (e.target.tagName === 'A') {
          e.preventDefault();
          const path = e.target.getAttribute('href');
          history.pushState(null, '', path);
          loadContent(path);
        }
      });

      document.addEventListener('DOMContentLoaded', () => {
        loadContent(window.location.pathname);
      });
    </script>
  </body>
</html>
